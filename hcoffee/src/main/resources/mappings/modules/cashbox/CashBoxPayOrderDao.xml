<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
         符号转义说明
    &lt;          < 
    &gt;          >  
    &lt;&gt;     <>
    &amp;        & 
    &apos;       '
    &quot;       "
  <![CDATA[ 这里写你的SQL或者符号 ]]> 
 -->
<mapper namespace="com.huilian.hlej.jet.modules.cashbox.dao.CashBoxPayOrderDao" > 

	<!-- Result Map 数据库映射到实体类  -->
	<resultMap id="tableMapToModel" type="com.huilian.hlej.jet.modules.cashbox.entity.CashBoxPayOrderModel" >
		<id column="id" property="id"/>
		<result column="transactionID" property="transactionID"/><!--交易流水号-->
		<result column="orderCode" property="orderCode"/><!--订单号-->
		<result column="payCode" property="payCode"/><!--支付流水号-->
		<result column="payType" property="payType"/><!--支付方式-->
		<result column="userId" property="userId"/><!--用户ID-->
		<result column="userName" property="userName"/>
		<result column="phone" property="phone"/><!--手机号-->
		<result column="identityCode" property="identityCode"/><!--身份证号码-->
		<result column="platformType" property="platformType"/><!--平台类型(1、汇理财；2、汇有房；3、汇生活)-->
		<result column="platformName" property="platformName"/><!--平台-->
		<result column="productId" property="productId"/><!--产品ID-->
		<result column="productName" property="productName"/><!--产品名称-->
		<result column="orderMoney" property="orderMoney"/><!--支付金额-->
		<result column="orderDateTime" property="orderDateTime"/><!--支付日期-->
		<result column="cardNo" property="orderAccounts"/><!--支付账号-->
		<result column="orderStatus" property="orderStatus"/><!--支付状态-->
		<result column="remark" property="remark"/><!--备注-->
		<result column="sellManager" property="sellManager"/><!--销售经理-->
		<result column="equipmentCode" property="equipmentCode"/><!--设备编号-->
		<result column="createUser" property="createUser"/><!--创建人-->
		<result column="createTime" property="createTime"/><!--创建时间-->
		<result column="brokerPhone" property="brokerPhone"/><!--经纪人电话-->
		<association property="seller" column="sellManager" select="com.huilian.hlej.jet.modules.sys.dao.UserDao.get"></association>
	</resultMap>

	<!--  -->
	<sql id="tbaleColumns">
		<trim suffix="" suffixOverrides=",">
			id,transactionID,orderCode,payCode,payType,userId,userName,phone,identityCode,platformType,platformName,productId,productName,orderMoney,orderDateTime,cardNo,orderStatus,remark,sellManager,equipmentCode,createUser,createTime,brokerPhone,
		</trim>
	</sql>
	<sql id="insertParamsAll">
		<trim suffix="" suffixOverrides=",">
			#{id},#{transactionID},#{orderCode},#{payCode},#{payType},#{userId},#{userName},#{phone},#{identityCode},#{platformType},#{platformName},#{productId},#{productName},#{orderMoney},#{orderDateTime},#{orderAccounts},#{orderStatus},#{remark},#{sellManager},#{equipmentCode},#{createUser},#{createTime},#{brokerPhone},
		</trim>
	</sql>
	<!-- updateParams  更新列 -->
	<sql id="updateParams">
		<trim suffix="" suffixOverrides=",">
			
	    </trim>
	</sql>
	<!-- 查询条件  包含所有 -->
	<sql id="andOtherAll">
		<trim  suffixOverrides="," >
			<if test="id != null and id != '' " >
				and id = #{id}
		    </if>
		    <if test="transactionID != null and transactionID != '' " >
				and transactionID =  #{transactionID}
		    </if>
		    <if test="orderCode != null and orderCode != '' " >
				and orderCode =  #{orderCode}
		    </if>
		    <if test="payCode != null and payCode != '' " >
				and payCode =  #{payCode}
		    </if>
		    <if test="payType != null" >
				and payType =  #{payType}
		    </if>
		    <if test="userId != null and userId != '' " >
				and userId =  #{userId}
		    </if>
		    <if test="userName != null and userName != '' " >
				and userName like 
					<if test="dbName == 'oracle'">'%'||#{userName}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{userName}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{userName},'%')</if>
		    </if>
		    <if test="phone != null and phone != '' " >
				and phone =  #{phone}
		    </if>
		    <if test="identityCode != null and identityCode != '' " >
				and identityCode =  #{identityCode}
		    </if>
		    <if test="platformType != null and platformType != '' " >
				and platformType =  #{platformType}
		    </if>
		    <if test="productId != null and productId != '' " >
				and productId =  #{productId}
		    </if>
		    <if test="productName != null and productName != '' " >
				and productName like 
					<if test="dbName == 'oracle'">'%'||#{productName}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{productName}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{productName},'%')</if>
		    </if>
		    <if test="orderAccounts != null and orderAccounts != '' " >
				and cardNo =  #{orderAccounts}
		    </if>
		    <if test="orderStatus != null" >
				and orderStatus =  #{orderStatus}
		    </if>
		    <if test="sellManager != null and sellManager != '' " >
				and sellManager in (SELECT id FROM sys_user WHERE name like 
					<if test="dbName == 'oracle'">'%'||#{sellManager}||'%'</if>
					<if test="dbName == 'mssql'">'%'+#{sellManager}+'%'</if>
					<if test="dbName == 'mysql'">concat('%',#{sellManager},'%')</if>)
		    </if>
		    <if test="equipmentCode != null and equipmentCode != '' " >
				and equipmentCode =  #{equipmentCode}
		    </if>
		    <if test="startDate != null and startDate != '' and endDate != null and endDate != '' " >
				and createTime BETWEEN '${startDate}' and '${endDate}'
		    </if>
		    <if test="brokerPhone != null and brokerPhone != '' " >
				and brokerPhone =  #{brokerPhone}
		    </if>
		</trim>
	</sql>
	<!-- columnKey  主键 列名称 ,视图获取不到主键 需要设置 -->
	<sql id="columnKey">
	     and id=#{id}
	</sql>
	<!-- 添加,插入记录   -->
	<insert id="insert"  parameterType="com.huilian.hlej.jet.modules.cashbox.entity.CashBoxPayOrderModel" >
	    insert into box_payorderinfo(<include refid="tbaleColumns"/>) values(<include refid="insertParamsAll"/>);
	</insert>
	<!-- 查询,主键查询   -->
	<select id="get"  resultMap="tableMapToModel" parameterType="java.lang.Object">
		select <include refid="tbaleColumns"/> from box_payorderinfo  where 1=1 <include refid="columnKey"/>
	</select>
	<select id="findByKey"  resultMap="tableMapToModel" parameterType="java.lang.Object">
		select <include refid="tbaleColumns"/> from box_payorderinfo  where 1=1 
		<if test="transactionID != null and transactionID != '' " >
			and transactionID =  #{transactionID}
	    </if>
		<if test="orderCode != null and orderCode != '' " >
			and orderCode =  #{orderCode}
	    </if>
	    <if test="payCode != null and payCode != '' " >
			and payCode =  #{payCode}
	    </if>
	</select>
	<!-- 查询,主键查询   -->
	<select id="findByCondition"  resultMap="tableMapToModel" parameterType="java.util.Map">
		select <include refid="tbaleColumns"/> from box_payorderinfo 
		where 1=1 <include refid="andOtherAll"/>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			ORDER BY createTime desc
			</otherwise>
		</choose>
	</select>
	<update id="updateStatus" parameterType="java.util.Map">
		UPDATE box_payorderinfo t 
		SET t.orderStatus = #{orderStatus}
		<if test="orderDateTime != null and orderDateTime != ''">
		, t.orderDateTime = #{orderDateTime}
		</if>
		WHERE t.id = #{id}
	</update>
	
	<!-- 查询,参数查询,Map分页 -->
	<select id="findByMapPaging" resultMap="tableMapToModel"  parameterType="java.util.Map">
		select <include refid="tbaleColumns"/>
		from box_payorderinfo
		where 1=1
		<include refid="andOtherAll"/>
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			ORDER BY createTime desc
			</otherwise>
		</choose>
	</select>
	<!-- 查询,总行数,Map分页 -->
	<select id="findByMapPagingCount" resultType="java.lang.Integer"  parameterType="java.util.Map">
		select count(1) from box_payorderinfo  where 1=1 <include refid="andOtherAll"/>
	</select>

</mapper>   
