<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
         符号转义说明
    &lt;          < 	
    &gt;          >  
    &lt;&gt;     <>
    &amp;        & 
    &apos;       '
    &quot;       "
  <![CDATA[ 这里写你的SQL或者符号 ]]> 
 -->
<mapper namespace="com.huilian.hlej.hcf.dao.AppUpgradeTaskDao" > 

		<insert id="saveAppUpgradeTask" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO `app_upgrade_task` (
			
		   vendId ,
		   vendCode ,
		   channel ,
		   channelName,
		   version ,
		   versionId,
		   versionCurrent  ,
		   versionCurrentId  ,
		   remark ,
		   status ,
		   downloadLink ,
		   createTime
		)
		VALUES
			(
			   #{vendId} ,
			   #{vendCode} ,
			   #{channel} ,
			   #{channelName},
			   #{version} ,
			   #{versionId},
			   #{versionCurrent}  ,
			   #{versionCurrentId}  ,
			   #{remark} ,
			   #{status} ,
			   #{downloadLink} ,
			   now()
			);
	</insert>
	
	 <select id="getVendUpgradeRecordByCode" resultType="com.huilian.hlej.hcf.vo.AppUpgradeRecordVo" parameterType="com.huilian.hlej.hcf.vo.AppUpgradeRecordVo">
		select vm.*,v.location from app_upgrade_task vm,hsh_vend_qr_code v 
		<where>
			1 = 1
        	<if test="vendCode != null and vendCode != ''">
                AND vm.vendCode = #{vendCode}
            </if>
            <if test="status != null">
                AND vm.status = #{status}
            </if>
            
        </where>
        AND vm.vendCode = v.vendcode  
        ORDER BY  vm.createTime desc
       
    </select>
	<select id="getAppUpgradeTask" resultType="com.huilian.hlej.hcf.entity.AppUpgradeTask" parameterType="com.huilian.hlej.hcf.entity.AppUpgradeTask">
        SELECT
			vm.*
		FROM
			app_upgrade_task vm   
			
		<where>
        	1 = 1
        	<if test="vendCode != null and vendCode != ''">
                AND vm.vendCode = #{vendCode}
            </if>
            <if test="status != null">
				AND vm.status = #{status}
			</if>
            
        </where>
       
    </select>
    
    
    <update id="updateAppUpgradeTask" >
       UPDATE `app_upgrade_task`
		<set>
			<if test="status != null ">
				status = #{status}
			</if>
		</set>
		WHERE id = #{id}	
       
    </update>
    
    
    
    <update id="batchUpgrade" parameterType="java.util.List" >
            UPDATE `app_upgrade_task` set status=0 where vendCode in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">   
            #{item}   
         </foreach>
    </update>
    
</mapper>   
