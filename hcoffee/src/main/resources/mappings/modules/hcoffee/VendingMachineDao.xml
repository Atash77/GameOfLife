<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
         符号转义说明
    &lt;          < 	
    &gt;          >  
    &lt;&gt;     <>
    &amp;        & 
    &apos;       '
    &quot;       "
  <![CDATA[ 这里写你的SQL或者符号 ]]> 
 -->
<mapper namespace="com.huilian.hlej.hcf.dao.VendingMachineDao" > 

		 <select id="getVendingStatisticsPage" resultType="CustInfoVo" >
		        SELECT
		         count(*) AS toltol,
		          t.vend_code AS vendCode,
				  v.communityName,
				  DATE_FORMAT(t.create_time, '%Y-%m-%d') AS createTime 
				 
				FROM
				    hkf_vend_cust_info t,
		           hsh_vend_qr_code v 
		        <where>
		        	 v.vendcode = t.vend_code 
		        	<if test="vendCode != null and vendCode != ''">
		                AND v.vendCode like CONCAT('%','${vendCode}','%' )
		            </if>
		            <if test="communityName != null and communityName != ''">
		                AND v.communityName  = #{communityName}
		            </if>
		            <if test="startTime != null and  startTime != ''">
		                AND v.createTime    &gt;=  #{startTime}
		            </if>
		    		<if test="endTime != null and  endTime != ''">
		                AND v.createTime    &lt;=  #{endTime}
		            </if>
		               group by  t.vend_code, v.communityName, DATE_FORMAT(t.create_time, '%Y-%m-%d')
		        </where>
		    	</select>

		<insert id="saveVendingMachine" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO `hsh_vend_qr_code` (
			
 		  `vendCode` ,
		  `channel` ,
		  `channelName` ,
		  `appVersion`,
		  `appVersionId` ,
		  `status` ,
		  `provinceId`,
		  `provinceName` ,
		  `cityId` ,
		  `cityName` ,
		  `areaId` ,
		  `areaName` ,
		  `communityId`,
		  `location` ,
		  `communityName` ,
		  `deliveryId` ,
		  `deliveryType` ,
		  `equipSupply` ,
		  `huiLink` ,
		  `createTime`,
		  `updateTime`,
		  `vendName`
		  
		)
		VALUES
			(
				#{vendCode},
				#{channel},
				#{channelName},
				#{appVersion},
				#{appVersionId},
				1,
				#{provinceId},
				#{provinceName},
				#{cityId},
				#{cityName},
				#{areaId},
				#{areaName},
				#{communityId},
				#{location},
				#{communityName},
				#{deliveryId},
				#{deliveryType},
				#{equipSupply},
				#{huiLink},
					now(),
					now(),
				#{vendName}	
			);
	</insert>
		<insert id="saveTubiao" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO `hsh_vend_lng_lat` (
			
 		  `vendCode` ,
		  `channel` ,
		   `channelName` ,
		   `lang` ,
		   `laction` ,
		   `lat` 
		  
		)
		VALUES
			(
				#{vendCode},
				#{channel},
				#{channelName},
				#{lang},
				#{laction},
				#{lat}
				
			);
	</insert>
	
	
	<update id="updateVendingMachine">
		UPDATE `hsh_vend_qr_code`
		<set>
			<if test="vendCode!=null and vendCode!=''">
				vendCode = #{vendCode},
			</if>
			<if test="channel!=null and channel!=''">
				channel = #{channel},
			</if>
			<if test="channelName!=null and channelName!=''">
				channelName = #{channelName},
			</if>
			<if test="appVersion!=null and appVersion!=''">
				appVersion = #{appVersion},
			</if>
			<if test="appVersionId!=null and appVersionId!=''">
				appVersionId = #{appVersionId},
			</if>
			<if test="status!=null and status!=''">
				status = #{status},
			</if>
 	         <if test="provinceName!=null and provinceName!=''">
				provinceName = #{provinceName},
			</if>
			<if test="communityId!=null and communityId!=''">
				communityId = #{communityId},
			</if>
			<if test="location!=null and location!=''">
				location = #{location},
			</if>
			
			<if test="cityId!=null and cityId!=''">
				cityId = #{cityId},
			</if>
			<if test="provinceId!=null and provinceId!=''">
				provinceId = #{provinceId},
			</if>
			<if test="areaId!=null and areaId!=''">
				areaId = #{areaId},
			</if>
		
			<if test="cityName!=null and cityName!=''">
				cityName = #{cityName},
			</if>
			<if test="areaName!=null and areaName!=''">
				areaName = #{areaName},
			</if>
			<if test="communityName!=null and communityName!=''">
				communityName = #{communityName},
			</if>
			<if test="deliveryType!=null and deliveryType!=''">
				deliveryType = #{deliveryType},
			</if>
		
			<if test="deliveryId!=null and deliveryId!=''">
				deliveryId = #{deliveryId},
			</if>
			<if test="equipSupply!=null and equipSupply!=''">
				equipSupply = #{equipSupply},
			</if>
			<if test="huiLink!=null and huiLink!=''">
				huiLink = #{huiLink},
			</if>
			updateTime = now(),
			<if test="vendName!=null and vendName!=''">
				vendName = #{vendName},
			</if>
		</set>
		WHERE id = #{id}		
	</update>
	 

	<update id="updateVendingByCode">
		UPDATE `hsh_vend_qr_code`
		<set>
			<if test="vendCode!=null and vendCode!=''">
				vendCode = #{vendCode},
			</if>
			<if test="oldTemplateId!=null and oldTemplateId!=''">
				oldTemplate_id = #{oldTemplateId},
			</if>
			
			<if test="templateId!=null and templateId!=''">
				template_id = #{templateId},
			</if>
			<if test="fabuRecort!=null and fabuRecort!=''">
				fabuRecort = #{fabuRecort},
			</if>
			<if test="optionType!=null and optionType!=''">
				optionType = #{optionType},
			</if>
			
			updateTime = now(),
		
		</set>
		WHERE vendCode = #{vendCode}		
	</update>


	 
	     <select id="findList" resultType="com.huilian.hlej.hcf.vo.VendingMachineVo" parameterType="com.huilian.hlej.hcf.vo.VendingMachineVo">
        SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm  
			 
        <where>
        	1 = 1
        	<if test="vendCode != null and vendCode != ''">
                AND vm.vendCode like CONCAT('%','${vendCode}','%' )
            </if>
            <if test="channel != null and channel != ''">
                AND vm.channel  = #{channel}
            </if>
            <if test="startTime != null and  startTime != ''">
                AND vm.upgradeTime    &gt;=  #{startTime}
            </if>
    		<if test="endTime != null and  endTime != ''">
                AND vm.upgradeTime    &lt;=  #{endTime}
            </if>
             <if test="vendCodeList != null and  vendCodeList != ''">
                AND vm.vendCode    in  (${vendCodeList})
            </if>
        </where>
       		    ORDER BY  vm.upgradeTime desc
           
       
    </select>
	 
	     <select id="getVendingMachineByTemplateId" resultType="com.huilian.hlej.hcf.vo.VendingMachineVo" parameterType="com.huilian.hlej.hcf.vo.VendingMachineVo">
        SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm  
			 
        <where>
        	1 = 1
        	<if test="vendCode != null and vendCode != ''">
                AND vm.vendCode like CONCAT('%','${vendCode}','%' )
            </if>
            <if test="channel != null and channel != ''">
                AND vm.channel  = #{channel}
            </if>
            <if test="startTime != null and  startTime != ''">
                AND vm.upgradeTime    &gt;=  #{startTime}
            </if>
            
            <if test="optionType != null and  optionType != ''">
			AND vm.optionType like CONCAT('%','${optionType}','%' )
		 </if>
			<if test="templateId != null and  templateId != ''">
			AND vm.template_id like CONCAT('%','${templateId}','%' )
		 </if>
	
			<if test="fabuRecort != null and  fabuRecort != ''">
			AND vm.fabuRecort like CONCAT('%','${fabuRecort}','%' )
		 </if>
		 
    		<if test="endTime != null and  endTime != ''">
                AND vm.upgradeTime    &lt;=  #{endTime}
            </if>
             <if test="vendCodeList != null and  vendCodeList != ''">
                AND vm.vendCode    in  (${vendCodeList})
            </if>
        </where>
       		    ORDER BY  vm.upgradeTime desc
           
       
    </select>

	     <select id="getVendingMachineByOptionType" resultType="com.huilian.hlej.hcf.vo.VendingMachineVo" parameterType="com.huilian.hlej.hcf.vo.VendingMachineVo">
        SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm 
		  where 1=1 
			<if test="optionType != null and  optionType != ''">
			AND vm.optionType like CONCAT('%','${optionType}','%' )
		</if>
			<if test="templateId != null and  templateId != ''">
			AND vm.template_id like CONCAT('%','${templateId}','%' )
		</if>
    </select>

    
 
	<!-- 查询,主键查询   -->
	<select id="getVendByCode"  resultType="com.huilian.hlej.hcf.vo.VendingMachineVo"  >
		SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm    where 1=1  and vendCode=#{0}
	</select>
	<!-- 查询,主键查询   -->
	<select id="getVendingMachineByCode"  resultType="com.huilian.hlej.hcf.entity.VendingMachine"  >
		SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm    where 1=1  and vendCode=#{0}
	</select>
	<!-- 查询,主键查询   -->  
	<select id="getVendingByVendcoed"  resultType="com.huilian.hlej.hcf.vo.VendingMachineVo"  >
		SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm    where 1=1  and vendCode=#{vendCode}
	</select>
	
	<!-- 查询,主键查询   -->
	<select id="gettuBiaoByVendCode"  resultType="com.huilian.hlej.hcf.entity.LngLat"  >
		SELECT
			vm.*
		FROM
			hsh_vend_lng_lat vm    where 1=1  and vendCode=#{0}
	</select>
	
	
	
	<!-- 查询,主键查询   -->
	<select id="getCityByProvinceId"  resultType="com.huilian.hlej.hcf.vo.CtiyVo"  >
		SELECT
			vm.*
		FROM
			hsh_jd_city vm    where 1=1  and province_id=#{0}
	</select>
 
	<!-- 查询,主键查询   -->
	<select id="getCityByCityId"  resultType="com.huilian.hlej.hcf.vo.CountyVo"  >
		SELECT
			vm.*
		FROM
			hsh_jd_county vm    where 1=1  and city_id=#{0}
	</select>
 
  
	<select id="getChannel"  resultType="com.huilian.hlej.hcf.entity.Channel"  >
		SELECT
			 channel_id  as   channelId,
			 channel_name as  channelName
		FROM
			hsh_channel     
	</select>
  
	<select id="getActivityType"  resultType="com.huilian.hlej.hcf.vo.ActivityTypeVo"  >
		SELECT
			 activity_id  as   activityId,
			 activityType as  activityType 	
		FROM
			hcf_activity_type     
	</select>
 
 	<select id="getActivityScheme"  resultType="com.huilian.hlej.hcf.entity.ActivityScheme"  >
		SELECT
			 schemeNo  as   schemeNo,
			 schemeName as  schemeName
		FROM
			hsh_activity_scheme     
	</select>
 	<select id="getActivityTypeMaxImg"  resultType="com.huilian.hlej.hcf.vo.ActivityManageVo"  >
		SELECT
			 schemeNo  as   schemeNo,
			 schemeName as  schemeName
		FROM
			hsh_activity_scheme    where 1=1  and activityType=1  
	</select>
 	<select id="getActivityTypeMinImg"  resultType="com.huilian.hlej.hcf.vo.ActivityManageVo"  >
		SELECT
			 schemeNo  as   schemeNo,
			 schemeName as  schemeName
		FROM
			hsh_activity_scheme     where 1=1  and activityType=2 
	</select>
 	<select id="getActivityTypes"  resultType="com.huilian.hlej.hcf.vo.ActivityManageVo"  >
		SELECT
			 schemeNo  as   schemeNo,
			 schemeName as  schemeName
		FROM
			hsh_activity_scheme     where 1=1  and activityType=3 
	</select>
 	<select id="getActivityTypeDai"  resultType="com.huilian.hlej.hcf.vo.ActivityManageVo"  >
		SELECT
			 schemeNo  as   schemeNo,
			 schemeName as  schemeName
		FROM
			hsh_activity_scheme     where 1=1  and activityType=4 
	</select>
 	<select id="selectSchemeName"  resultType="com.huilian.hlej.hcf.entity.ActivityScheme"  >
		SELECT
			*
		FROM
			hsh_activity_scheme     where 1=1  and   schemeNo=#{schemeNo}
	</select>
 
 
	<select id="getCommunity"  resultType="java.util.Map"  >
		SELECT
			 community_id  as   communityId,
			 community_name as  communityName
		FROM
			hsh_community     
	</select>
	<select id="getprovinceName"  resultType="java.util.Map"  >
		SELECT
			 province_id  as   provinceId,
			 province_name as  provinceName
		FROM
			hsh_jd_province     
	</select>
	<select id="getCityName"  resultType="java.util.Map"  >
		SELECT
			 city_id  as   cityId,
			 city_name as  cityName
		FROM
			hsh_jd_city     
	</select>
	<select id="getAreaName"  resultType="java.util.Map"  >
		SELECT
			 county_id  as   countyId,
			 county_name as  countyName
		FROM
			hsh_jd_county     
	</select>
	
	<select id="getDeliveryType"  resultType="java.util.Map"  >
		SELECT
			 delivery_id  as   deliveryId,
			 delivery_type as  deliveryType
		FROM
			hcf_vend_supply     
	</select>
	
	<select id="getEquipSupply"  resultType="java.util.Map"  >
		SELECT
			 id  as   id,
			 equipSupply as  equipSupply
		FROM
			hsh_vend_qr_code     
	</select>
	
<select id="getAppVersionRecords"  resultType="com.huilian.hlej.hcf.entity.AppVersionRecords"  >
		SELECT
			 *
		FROM
			app_version_records     
	</select>
 
	

	<select id="getMachineCode"  resultType="java.util.Map">
		SELECT
			 id  as   id,
			 vendCode as   vendCode
			 
		FROM
			hsh_vend_qr_code  
       
	</select>
		
	<select id="getAppVersionbyId"  resultType="com.huilian.hlej.hcf.entity.AppVersionRecords"  >
		SELECT
			 *
		FROM
			app_version_records     where  id=#{id}
	</select>
	<update id="updateStatusByCode"  >
		UPDATE `hsh_vend_qr_code`  set status = #{0}   WHERE vendcode = #{1}	
	 </update>
	 
	<update id="udateTubiao"  >
		UPDATE `hsh_vend_lng_lat`
		<set>
			
			<if test="lang!=null and lang!=''">
				lang = #{lang},
			</if>
			<if test="lat!=null and lat!=''">
				lat = #{lat},
			</if>
			<if test="laction!=null and laction!=''">
				laction = #{laction}
			</if>
			where vendCode = #{vendCode}
		</set>	
	 </update>
	 
	 
	 
	
	
		<select id="findVendingMachineList" resultType="com.huilian.hlej.hcf.vo.VendingMachineVo"
		parameterType="com.huilian.hlej.hcf.vo.VendingMachineVo">
		SELECT
		hsh_vend_qr_code.*,
		hsh_vend_lng_lat.laction as langLaction
		FROM
		hsh_vend_qr_code
		left join hsh_vend_lng_lat
		on (hsh_vend_qr_code.vendCode = hsh_vend_lng_lat.vendCode)
		where 1=1
		<if test="vendCode != null and  vendCode != ''">
			AND hsh_vend_qr_code.vendCode like CONCAT('%','${vendCode}','%' )
		</if>
		<if test="channel != null and  channel != ''">
			AND hsh_vend_qr_code.channel like CONCAT('%','${channel}','%' )
		</if>
		<if test="channelName != null and  channelName != ''">
			AND hsh_vend_qr_code.channel_name like CONCAT('%','${channelName}','%' )
		</if>
		
		<if test="communityId != null and  communityId != ''">
			AND hsh_vend_qr_code.communityId like CONCAT('%','${communityId}','%' )
		</if>
		<if test="communityName != null and  communityName != ''">
			AND hsh_vend_qr_code.communityName like CONCAT('%','${communityName}','%' )
		</if>
		<if test="provinceId != null and  provinceId != ''">
			AND hsh_vend_qr_code.provinceId &gt;= #{provinceId}
		</if>
		<if test="cityId != null and  cityId != ''">
			AND hsh_vend_qr_code.cityId &lt;= #{cityId}
		</if>
		<if test="areaId != null and  areaId != ''">
			AND hsh_vend_qr_code.areaId &gt;= #{areaId}
		</if>
		<if test="provinceName != null and  provinceName != ''">
			AND hsh_vend_qr_code.provinceName &lt;= #{provinceName}
		</if>
		<if test="cityName != null and  cityName != ''">
			AND hsh_vend_qr_code.cityName &gt;= #{cityName}
		</if>
		<if test="areaName != null and  areaName != ''">
			AND hsh_vend_qr_code.areaName &lt;= #{areaName}
		</if>
	
		<if test="communityName != null and  communityName != ''">
			AND hsh_vend_qr_code.communityName in (${communityName})
		</if>
		<if test="deliveryType != null and  deliveryType != ''">
			AND hsh_vend_qr_code.deliveryType in (${deliveryType})
		</if>
		<if test="deliveryId != null and  deliveryId != ''">
			AND hsh_vend_qr_code.deliveryId in (${deliveryId})
		</if>
		<if test="appVersionId != null and  appVersionId != ''">
			AND hsh_vend_qr_code.appVersionId in (${appVersionId})
		</if>
		<if test="version != null and  version != ''">
			AND hsh_vend_qr_code.version in (${version})
		</if>
		<if test="equipSupply != null and  equipSupply != ''">
			AND hsh_vend_qr_code.equipSupply in (${equipSupply})
		</if>
	
		ORDER BY hsh_vend_qr_code.updateTime DESC  
	</select>
	
  <select id="getTuBiaoList" resultType="com.huilian.hlej.hcf.entity.LngLat"
		parameterType="com.huilian.hlej.hcf.entity.LngLat">
		SELECT
		*
		FROM
		hsh_vend_lng_lat
		where 1=1
		
	</select>
	
	
	<select id="getLocalList"  resultType="com.huilian.hlej.hcf.entity.LngLat"  >
		SELECT
			vm.*
		FROM
			hsh_vend_lng_lat vm    where 1=1  
	</select>
	
	
	<update id="updateVendByWechat">
		UPDATE `hsh_vend_qr_code`
		<set>
			<if test="wechatModelNo !=null and wechatModelNo !=''">
				wechatModelNo = #{wechatModelNo},
			</if>
			<if test="wechatOptionType !=null and wechatOptionType !=''">
				wechatOptionType = #{wechatOptionType},
			</if>
			
			<if test="oldWechatModelNo !=null and oldWechatModelNo !=''">
				oldWechatModelNo = #{oldWechatModelNo},
			</if>
			<if test="updateTime !=null and updateTime !=''">
				updateTime = #{updateTime},
			</if>
			<if test="wechatOptionTime !=null and wechatOptionTime !=''">
				wechatOptionTime = #{wechatOptionTime},
			</if>
			
		
		</set>
		WHERE id = #{id}		
	</update>
	
	 <select id="getVendByWechatModelNo" resultType="com.huilian.hlej.hcf.vo.VendingMachineVo" parameterType="com.huilian.hlej.hcf.vo.VendingMachineVo">
        SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm  
			 
        <where>
        	1 = 1
            <if test="wechatModelNo != null and wechatModelNo != '' or oldWechatModelNo != null and oldWechatModelNo != ''">
                AND (vm.wechatModelNo  = #{wechatModelNo} or vm.oldWechatModelNo  = #{oldWechatModelNo})
            </if>
        </where>
       		    ORDER BY  vm.upgradeTime desc
    </select>
	
	
	<select id="getVendingMachineByModelNo" resultType="com.huilian.hlej.hcf.vo.VendingMachineVo" parameterType="com.huilian.hlej.hcf.vo.VendingMachineVo">
        SELECT
			vm.*
		FROM
			hsh_vend_qr_code vm  
			 
        <where>
        	1 = 1
        	<if test="vendCode != null and vendCode != ''">
                AND vm.vendCode like CONCAT('%','${vendCode}','%' )
            </if>
            <if test="channel != null and channel != ''">
                AND vm.channel  = #{channel}
            </if>
            
			<if test="wechatModelNo != null and  wechatModelNo != ''">
			AND vm.wechatModelNo = #{wechatModelNo}
		 </if>
			<if test="wechatOptionType != null and  wechatOptionType != ''">
			AND vm.wechatOptionType = #{wechatOptionType}
		 </if>
			<if test="oldWechatModelNo != null and  oldWechatModelNo != ''">
			AND vm.oldWechatModelNo = #{oldWechatModelNo}
		 </if>
        </where>
       		    ORDER BY  vm.updateTime desc
    </select>
    
    <!-- 快速添加 -->
    <insert id="fastSaveVendingMachine" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO `hkf`.`hsh_vend_qr_code` (
			`vendCode`,
			`channel`,
			`groupId`,
			`appVersion`,
			`upgradeTime`,
			`upgradeRemark`,
			`status`,
			`provinceId`,
			`cityId`,
			`areaId`,
			`communityId`,
			`location`,
			`createTime`,
			`updateTime`,
			`provinceName`,
			`cityName`,
			`areaName`,
			`communityName`,
			`appVersionId`,
			`channelName`,
			`deliveryType`,
			`equipSupply`,
			`huiLink`,
			`deliveryId`,
			`template_id`,
			`optionType`,
			`oldTemplate_id`,
			`fabuRecort`,
			`wechatModelNo`,
			`wechatOptionType`,
			`oldWechatModelNo`,
			`wechatOptionTime`,
			`vendName`
		)
		VALUES
			(
				#{vendCode},
				'16993204',
				NULL,
				'big_huicoffee_1.97',
				NULL,
				NULL,
				'1',
				'13',
				'1090',
				'1093',
				'352161',
				#{location},
				NOW(),
				NOW(),
				'山东',
				'滨州市',
				'沾化县',
				'汇咖啡测试',
				'31',
				'汇生活',
				'社区',
				'便捷神供应',
				' ',
				'100001',
				'8001',
				'1',
				'100003',
				'1',
				NULL,
				NULL,
				NULL,
				NULL,
				NULL
			)
	</insert>
	
</mapper>   
