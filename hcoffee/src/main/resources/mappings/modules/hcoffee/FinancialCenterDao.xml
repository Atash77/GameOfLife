<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
         符号转义说明
    &lt;          < 	
    &gt;          >  
    &lt;&gt;     <>
    &amp;        & 
    &apos;       '
    &quot;       "
  <![CDATA[ 这里写你的SQL或者符号 ]]> 
 -->
<mapper namespace="com.huilian.hlej.hcf.dao.FinancialCenterDao" > 
	<!-- 添加模版 -->
	<insert id="saveDivideAccountVo" useGeneratedKeys="true" keyProperty="id">
		<![CDATA[
			INSERT INTO `hcf_dealer_divide_account_template` (
			  `templateName` ,
			  `settlementWay` ,
			  `projectType` ,
			  `saleOne` ,
			  `fristMonthOne_sale` ,
			  `fristMonthTwo_sale`,
			  `secondMonthOne_sale` ,
			  `secondMonthTwo_sale` ,
			  `threeMonthOne_sale` ,
			  `threeMonthTwo_sale` ,
			  `fourthMonthOne_sale` ,
			  `fourthMonthTwo_sale` ,
			  `saleSecond_1` ,
			  `saleSecond_2` ,
			  `saleThree` ,
			  `fristSaleValue_1` ,
			  `secondSaleValue_1`,
			  `threeSaleValue_1` ,
			  `fourthSaleValue_1` ,
			  `fristSaleValue_2` ,
			  `secondSaleValue_2` ,
			  `threeSaleValue_2`,
			  `fourthSaleValue_2`,
			  `fristSaleValue_3`,
			  `secondSaleValue_3`,
			  `threeSaleValue_3`,
			  `fourthSaleValue_3`,
			  `fristMonthOne_vend`,
			  `fristMonthTwo_vend`,
			  `secondMonthOne_vend`,
			  `secondMonthTwo_vend`,
			  `threeMonthOne_vend`,
			  `threeMonthTwo_vend`,
			  `fourthMonthOne_vend`,
			  `fourthMonthTwo_vend`,
			  `fristSaleValue_vend`,
			  `secondSaleValue_vend`,
			  `threeSaleValue_vend`,
			  `fourthSaleValue_vend`,
			  `advertMoney`,
			  `createTime`
			)
			VALUES
				(
					#{templateName},
					#{settlementWay},
					#{probjectType},
					#{saleOne},
					#{fristMonthOne_sale},
					#{fristMonthTwo_sale},
					#{secondMonthOne_sale},
					#{secondMonthTwo_sale},
					#{threeMonthOne_sale},
					#{threeMonthTwo_sale},
					#{fourthMonthOne_sale},
					#{fourthMonthTwo_sale},
					#{saleSecond_1},
					#{saleSecond_2},
					#{saleThree},
					#{fristSaleValue_1},
					#{secondSaleValue_1},
					#{threeSaleValue_1},
					#{fourthSaleValue_1},
					#{fristSaleValue_2},
					#{secondSaleValue_2},
					#{threeSaleValue_2},
					#{fourthSaleValue_2},
					#{fristSaleValue_3},
					#{secondSaleValue_3},
					#{threeSaleValue_3},
					#{fourthSaleValue_3},
					#{fristMonthOne_vend},
					#{fristMonthTwo_vend},
					#{secondMonthOne_vend},
					#{secondMonthTwo_vend},
					#{threeMonthOne_vend},
					#{threeMonthTwo_vend},
					#{fourthMonthOne_vend},
					#{fourthMonthTwo_vend},
					#{fristSaleValue_vend},
					#{secondSaleValue_vend},
					#{threeSaleValue_vend},
					#{fourthSaleValue_vend},
					#{advertMoney},
					now()
				)
			]]> 
	</insert>
	
	<!-- 修改模版 -->
  		<update id="updateDivideAccountVo" parameterType="com.huilian.hlej.hcf.vo.DivideAccountVo">
		UPDATE `hcf_dealer_divide_account_template`
		<set>
			<if test="templateName!=null and templateName!=''">
				templateName = #{templateName},
			</if>
			<if test="settlementWay!=null and settlementWay!=''">
				settlementWay = #{settlementWay},
			</if>
			<if test="probjectType!=null and probjectType!=''">
				projectType = #{probjectType},
			</if>
			<if test="operator!=null and operator!=''">
				operator = #{operator},
			</if>
            <if test="saleOne!=null and saleOne!=''">
				saleOne = #{saleOne},
			</if>
            <if test="fristMonthOne_sale!=null and fristMonthOne_sale!=''">
				fristMonthOne_sale = #{fristMonthOne_sale},
			</if>
            <if test="fristMonthTwo_sale!=null and fristMonthTwo_sale!=''">
				fristMonthTwo_sale = #{fristMonthTwo_sale},
			</if>
            <if test="secondMonthOne_sale!=null and secondMonthOne_sale!=''">
				secondMonthOne_sale = #{secondMonthOne_sale},
			</if>
            <if test="secondMonthTwo_sale!=null and secondMonthTwo_sale!=''">
				secondMonthTwo_sale = #{secondMonthTwo_sale},
			</if>
            <if test="threeMonthOne_sale!=null and threeMonthOne_sale!=''">
				threeMonthOne_sale = #{threeMonthOne_sale},
			</if>
            <if test="threeMonthTwo_sale!=null and threeMonthTwo_sale!=''">
				threeMonthTwo_sale = #{threeMonthTwo_sale},
			</if>
            <if test="fourthMonthOne_sale!=null and fourthMonthOne_sale!=''">
				fourthMonthOne_sale = #{fourthMonthOne_sale},
			</if>
            <if test="fourthMonthTwo_sale!=null and fourthMonthTwo_sale!=''">
				fourthMonthTwo_sale = #{fourthMonthTwo_sale},
			</if>
            <if test="saleSecond_1!=null and saleSecond_1!=''">
				saleSecond_1 = #{saleSecond_1},
			</if>
            <if test="saleSecond_2!=null and saleSecond_2!=''">
				saleSecond_2 = #{saleSecond_2},
			</if>
            <if test="saleThree!=null and saleThree!=''">
				saleThree = #{saleThree},
			</if>
            <if test="fristSaleValue_1!=null and fristSaleValue_1!=''">
				fristSaleValue_1 = #{fristSaleValue_1},
			</if>
            <if test="secondSaleValue_1!=null and secondSaleValue_1!=''">
				secondSaleValue_1 = #{secondSaleValue_1},
			</if>
            <if test="threeSaleValue_1!=null and threeSaleValue_1!=''">
				threeSaleValue_1 = #{threeSaleValue_1},
			</if>
            <if test="fourthSaleValue_1!=null and fourthSaleValue_1!=''">
				fourthSaleValue_1 = #{fourthSaleValue_1},
			</if>
            <if test="fristSaleValue_2!=null and fristSaleValue_2!=''">
				fristSaleValue_2 = #{fristSaleValue_2},
			</if>
            <if test="secondSaleValue_2!=null and secondSaleValue_2!=''">
				secondSaleValue_2 = #{secondSaleValue_2},
			</if>
            <if test="threeSaleValue_2!=null and threeSaleValue_2!=''">
				threeSaleValue_2 = #{threeSaleValue_2},
			</if>
            <if test="fourthSaleValue_2!=null and fourthSaleValue_2!=''">
				fourthSaleValue_2 = #{fourthSaleValue_2},
			</if>
            <if test="saleThree!=null and saleThree!=''">
				saleThree = #{saleThree},
			</if>
			<if test="fristSaleValue_3!=null and fristSaleValue_3!=''">
				fristSaleValue_3 = #{fristSaleValue_3},
			</if>
            <if test="secondSaleValue_3!=null and secondSaleValue_3!=''">
				secondSaleValue_3 = #{secondSaleValue_3},
			</if>
            <if test="threeSaleValue_3!=null and threeSaleValue_3!=''">
				threeSaleValue_3 = #{threeSaleValue_3},
			</if>
            <if test="fourthSaleValue_3!=null and fourthSaleValue_3!=''">
				fourthSaleValue_3 = #{fourthSaleValue_3},
			</if>
			<if test="fristMonthOne_vend!=null and fristMonthOne_vend!=''">
				fristMonthOne_vend = #{fristMonthOne_vend},
			</if>
			<if test="fristMonthTwo_vend!=null and fristMonthTwo_vend!=''">
				fristMonthTwo_vend = #{fristMonthTwo_vend},
			</if>
			<if test="secondMonthOne_vend!=null and secondMonthOne_vend!=''">
				secondMonthOne_vend = #{secondMonthOne_vend},
			</if>
			<if test="secondMonthTwo_vend!=null and secondMonthTwo_vend!=''">
				secondMonthTwo_vend = #{secondMonthTwo_vend},
			</if>
			<if test="threeMonthOne_vend!=null and threeMonthOne_vend!=''">
				threeMonthOne_vend = #{threeMonthOne_vend},
			</if>
			<if test="threeMonthTwo_vend!=null and threeMonthTwo_vend!=''">
				threeMonthTwo_vend = #{threeMonthTwo_vend},
			</if>
			<if test="fourthMonthOne_vend!=null and fourthMonthOne_vend!=''">
				fourthMonthOne_vend = #{fourthMonthOne_vend},
			</if>
			<if test="fourthMonthTwo_vend!=null and fourthMonthTwo_vend!=''">
				fourthMonthTwo_vend = #{fourthMonthTwo_vend},
			</if>
			<if test="fristSaleValue_vend!=null and fristSaleValue_vend!=''">
				fristSaleValue_vend = #{fristSaleValue_vend},
			</if>
			<if test="secondSaleValue_vend!=null and secondSaleValue_vend!=''">
				secondSaleValue_vend = #{secondSaleValue_vend},
			</if>
			<if test="threeSaleValue_vend!=null and threeSaleValue_vend!=''">
				threeSaleValue_vend = #{threeSaleValue_vend},
			</if>
			<if test="fourthSaleValue_vend!=null and fourthSaleValue_vend!=''">
				fourthSaleValue_vend = #{fourthSaleValue_vend},
			</if>
			<if test="advertMoney!=null and advertMoney!=''">
				advertMoney = #{advertMoney},
			</if>
			    updateTime = now()
		</set>
		<where>
				id = ${id}
		</where>
	</update>
	
	<!-- 查询模版列表 -->	
	<select id="getDivideAccountQueryPage" parameterType="DivideAccountVo" resultType="DivideAccountVo">
	SELECT t.*
	FROM
	hcf_dealer_divide_account_template t
	<where>
		<if test="templateName != null and templateName != ''">
			AND t.templateName like CONCAT('%','${templateName}','%' )
		</if>
		<if test="startTimeStr != null and  startTimeStr != ''">
           	AND DATE_FORMAT(t.createTime,'%Y-%m-%d') &gt;=  #{startTimeStr}
           </if>
   		<if test="endTimeStr != null and  endTimeStr != ''">
            AND DATE_FORMAT(t.createTime,'%Y-%m-%d') &lt;=  #{endTimeStr}
        </if>
	</where>
	  ORDER BY  t.createTime desc
	</select>
	
	<resultMap id="divideAccountVoMap" type="com.huilian.hlej.hcf.vo.DivideAccountVo">
		<result column="id" property="id" jdbcType="VARCHAR"/>
		<result column="templateName" property="templateName" jdbcType="VARCHAR"/>
		<result column="settlementWay" property="settlementWay" jdbcType="NUMERIC"/>
		<result column="projectType" property="probjectType" jdbcType="NUMERIC"/>
		<result column="fristMonthOne_sale" property="fristMonthOne_sale" jdbcType="NUMERIC"/>
		<result column="fristMonthTwo_sale" property="fristMonthTwo_sale" jdbcType="NUMERIC"/>
		<result column="secondMonthOne_sale" property="secondMonthOne_sale" jdbcType="NUMERIC"/>
		<result column="secondMonthTwo_sale" property="secondMonthTwo_sale" jdbcType="NUMERIC"/>
		<result column="threeMonthOne_sale" property="threeMonthOne_sale" jdbcType="NUMERIC"/>
		<result column="threeMonthTwo_sale" property="threeMonthTwo_sale" jdbcType="NUMERIC"/>
		<result column="fourthMonthOne_sale" property="fourthMonthOne_sale" jdbcType="NUMERIC"/>
		<result column="fourthMonthTwo_sale" property="fourthMonthTwo_sale" jdbcType="NUMERIC"/>
		<result column="fristSaleValue_1" property="fristSaleValue_1" jdbcType="DOUBLE"/>
		<result column="secondSaleValue_1" property="secondSaleValue_1" jdbcType="DOUBLE"/>
		<result column="threeSaleValue_1" property="threeSaleValue_1" jdbcType="DOUBLE"/>
		<result column="fourthSaleValue_1" property="fourthSaleValue_1" jdbcType="DOUBLE"/>
		<result column="fristSaleValue_2" property="fristSaleValue_2" jdbcType="DOUBLE"/>
		<result column="secondSaleValue_2" property="secondSaleValue_2" jdbcType="DOUBLE"/>
		<result column="threeSaleValue_2" property="threeSaleValue_2" jdbcType="DOUBLE"/>
		<result column="fourthSaleValue_2" property="fourthSaleValue_2" jdbcType="DOUBLE"/>
		<result column="fristSaleValue_3" property="fristSaleValue_3" jdbcType="DOUBLE"/>
		<result column="secondSaleValue_3" property="secondSaleValue_3" jdbcType="DOUBLE"/>
		<result column="threeSaleValue_3" property="threeSaleValue_3" jdbcType="DOUBLE"/>
		<result column="fourthSaleValue_3" property="fourthSaleValue_3" jdbcType="DOUBLE"/>
		<result column="fristMonthOne_vend" property="fristMonthOne_vend" jdbcType="NUMERIC"/>
		<result column="fristMonthTwo_vend" property="fristMonthTwo_vend" jdbcType="NUMERIC"/>
		<result column="secondMonthOne_vend" property="secondMonthOne_vend" jdbcType="NUMERIC"/>
		<result column="secondMonthTwo_vend" property="secondMonthTwo_vend" jdbcType="NUMERIC"/>
		<result column="threeMonthOne_vend" property="threeMonthOne_vend" jdbcType="NUMERIC"/>
		<result column="threeMonthTwo_vend" property="threeMonthTwo_vend" jdbcType="NUMERIC"/>
		<result column="fourthMonthOne_vend" property="fourthMonthOne_vend" jdbcType="NUMERIC"/>
		<result column="fourthMonthTwo_vend" property="fourthMonthTwo_vend" jdbcType="NUMERIC"/>
		<result column="fristSaleValue_vend" property="fristSaleValue_vend" jdbcType="DOUBLE"/>
		<result column="secondSaleValue_vend" property="secondSaleValue_vend" jdbcType="DOUBLE"/>
		<result column="threeSaleValue_vend" property="threeSaleValue_vend" jdbcType="DOUBLE"/>
		<result column="fourthSaleValue_vend" property="fourthSaleValue_vend" jdbcType="DOUBLE"/>
		<result column="createTime" property="createTime" jdbcType="TIMESTAMP"/>
		<result column="updateTime" property="updateTime" jdbcType="TIMESTAMP"/>
		<result column="operator" property="operator" jdbcType="VARCHAR"/>
		<result column="saleOne" property="saleOne" jdbcType="DOUBLE"/>
		<result column="saleSecond_1" property="saleSecond_1" jdbcType="DOUBLE"/>
		<result column="saleSecond_2" property="saleSecond_2" jdbcType="DOUBLE"/>
		<result column="saleThree" property="saleThree" jdbcType="DOUBLE"/>
		<result column="advertMoney" property="advertMoney" jdbcType="DOUBLE"/>
	</resultMap>
	
	<!-- 查询单个模版 -->	
	<select id="getDivideAccountVo" parameterType="java.lang.String" resultMap="divideAccountVoMap">
		SELECT 
			id,templateName,settlementWay,projectType,fristMonthOne_sale,fristMonthTwo_sale,secondMonthOne_sale,
			secondMonthTwo_sale,threeMonthOne_sale,threeMonthTwo_sale,fourthMonthOne_sale,fourthMonthTwo_sale,
			fristSaleValue_1,secondSaleValue_1,threeSaleValue_1,fourthSaleValue_1,fristSaleValue_2,secondSaleValue_2,
			threeSaleValue_2,fourthSaleValue_2,fristSaleValue_3,secondSaleValue_3,threeSaleValue_3,fourthSaleValue_3,
			fristMonthOne_vend,fristMonthTwo_vend,secondMonthOne_vend,secondMonthTwo_vend,threeMonthOne_vend,threeMonthTwo_vend,
			fourthMonthOne_vend,fourthMonthTwo_vend,fristSaleValue_vend,secondSaleValue_vend,threeSaleValue_vend,fourthSaleValue_vend,
			createTime,updateTime,operator,saleOne,saleSecond_1,saleSecond_2,saleThree,advertMoney
		FROM
		hcf_dealer_divide_account_template
		<where>
			id = #{id}
		</where>
	</select>
	
	<resultMap id="dealerTemplateVoMap" type="com.huilian.hlej.hcf.vo.DealerTemplateVo">
		<result column="id" property="id" jdbcType="NUMERIC"/>
		<result column="loginName" property="loginName" jdbcType="VARCHAR"/>
		<result column="dealerName" property="dealerName" jdbcType="VARCHAR"/>
		<result column="templateId" property="templateId" jdbcType="NUMERIC"/>
		<result column="dealerType" property="dealerType" jdbcType="NUMERIC"/>
		<result column="useTime" property="useTime" jdbcType="TIMESTAMP"/>
		<result column="useTimeStr" property="useTimeStr" jdbcType="VARCHAR"/>
	</resultMap>
	
	<!-- 查询某个模版关联的信息  -->
	<select id="getDealerTemplateVoList" parameterType="java.lang.String" resultMap="dealerTemplateVoMap">
	SELECT id,loginName,dealerName,templateId,dealerType,useTime, DATE_FORMAT(useTime,'%Y-%m-%d %H:%m:%s') as useTimeStr
	FROM
	hcf_dealer_template t
	<where>
		templateId = #{templateId}
	</where>
	  ORDER BY t.useTime desc
	</select>
	
	<!-- 查询代理商登录名与其所拥有的机器数 -->
	<select id="loginNameAndVendsMap" resultType="java.util.Map">
		<![CDATA[
			select loginName,GROUP_CONCAT(vendCode) as vendCodes from hcf_vend_dealer GROUP BY loginName
		]]>
	</select>
	
	<!-- 查询代理商所有机器上一个月的销售额 -->
	<select id="beforeMonthSaleMoney" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			select ifnull(sum(amount),0) as saleMoney from
			(
			  SELECT
				sum(amount) as amount
			FROM
				hcf_vend_order_info
			WHERE
				orderStatus = 1
			AND vendCode IN (${vendCodes})
			AND PERIOD_DIFF(DATE_FORMAT(NOW(),'%Y%m'),DATE_FORMAT(shipTime,'%Y%m'))=1
			GROUP BY goodsId 
			) as temp
		]]>
	</select>
	
	<!-- 查询代理商所有机器上当前月的销售额 -->
	<select id="currentMonthSaleMoney" parameterType="java.util.Map"  resultType="java.lang.Integer">
		select ifnull(sum(amount),0) as curMonthSaleMoney from
			(
			  SELECT
				sum(amount) as amount
			FROM
				hcf_vend_order_info
			WHERE
				orderStatus = 1
			AND vendCode IN (${vendCodes})
			AND DATE_FORMAT(shipTime,'%Y%m') = DATE_FORMAT(CURDATE(),'%Y%m')
			GROUP BY goodsId 
			) as temp
	</select>
	
	<resultMap id="yearMonthMap" type="com.huilian.hlej.hcf.vo.DealerFoundFlowVo">
		<result column="monthStr" property="monthStr" jdbcType="VARCHAR"/>
		<result column="num" property="num" jdbcType="NUMERIC"/>
	</resultMap>
	
	<!-- 根据机器码查询月份绑定的机器数量 -->	
	<select id="monthVendNumList" parameterType="java.util.Map" resultMap="yearMonthMap">
		<![CDATA[
			SELECT
				DATE_FORMAT(bangdingTime, '%Y-%m') as monthStr,
				count(*) as num
			FROM
				hcf_vend_dealer t
			WHERE
				t.vendCode IN (${vendCodes})
			GROUP BY
				DATE_FORMAT(bangdingTime, '%Y-%m')
		]]>
	</select>
	
	<!-- 根据代理商登录名查询最新模版的应用时间 -->
	<select id="getUseTimeByLoginName" parameterType="java.lang.String" resultType="java.util.Map">
		<![CDATA[
			SELECT
				DATE_FORMAT(useTime, '%Y-%m') AS useTimeStr,
				templateId
			FROM
				hcf_dealer_template
			WHERE
				loginName = #{loginName}
			ORDER BY
				useTime DESC
			LIMIT 0,1
		]]>
	</select>
	
		<!-- 判断上一个月销售额是否在  销售额<= 销售额区间里  -->
	<select id="isSaleOne" parameterType="java.util.Map" resultType="java.lang.Integer">
		select count(1) from hcf_dealer_divide_account_template where id=#{templateId} and saleOne &gt;= #{saleMoney}
	</select>
	
	<!-- 判断是否属第一个月份区间 -->
	<select id="isFristMonthSale" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			SELECT
				count(1) 
			FROM
				hcf_dealer_divide_account_template
			WHERE
				id = #{templateId}
			AND #{monthNum} BETWEEN fristMonthOne_sale
			AND fristMonthTwo_sale
		]]>
	</select>
	
	<!-- 查询属第一个月份区间的参数值  -->
	<select id="getFristMonthSaleValue_1" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fristSaleValue_1 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	<!-- 判断是否属第二个月份区间 -->
	<select id="isSecondMonthSale" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			SELECT
				count(1) 
			FROM
				hcf_dealer_divide_account_template
			WHERE
				id = #{templateId}
			AND #{monthNum} BETWEEN secondMonthOne_sale
			AND secondMonthTwo_sale
		]]>
	</select>
	
	<!-- 查询属第二个月份区间的参数值  -->
	<select id="getSecondMonthSaleValue_1" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select secondSaleValue_1 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 判断是否属第三个月份区间 -->
	<select id="isThreeMonthSale" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			SELECT
				count(1) 
			FROM
				hcf_dealer_divide_account_template
			WHERE
				id = #{templateId}
			AND #{monthNum} BETWEEN threeMonthOne_sale
			AND threeMonthTwo_sale
		]]>
	</select>
	
	<!-- 查询属第三个月份区间的参数值  -->
	<select id="getThreeMonthSaleValue_1" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select threeSaleValue_1 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>	
	
	<!-- 判断是否属第四个月份区间 -->
	<select id="isFourthMonthSale" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			SELECT
				count(1) 
			FROM
				hcf_dealer_divide_account_template
			WHERE
				id = #{templateId}
			AND #{monthNum} BETWEEN fourthMonthOne_sale
			AND fourthMonthTwo_sale
		]]>
	</select>
	
	<!-- 查询属第四个月份区间的参数值  -->
	<select id="getFourthMonthSaleValue_1" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fourthSaleValue_1 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 判断上一个月销售额是否在  <  销售额  ≤ 区间里  -->
	<select id="isSaleTwo" parameterType="java.util.Map" resultType="java.lang.Integer">
			select count(1) from hcf_dealer_divide_account_template t 
			where id=#{templateId} 
			and saleSecond_1 &lt; #{saleMoney} 
			and #{saleMoney} &lt;= t.saleSecond_2
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第一个月份区间的参数值  -->
	<select id="getFristMonthSaleValue_2" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fristSaleValue_2 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第二个月份区间的参数值  -->
	<select id="getSecondMonthSaleValue_2" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select secondSaleValue_2 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第三个月份区间的参数值  -->
	<select id="getThreeMonthSaleValue_2" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select threeSaleValue_2 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第四个月份区间的参数值  -->
	<select id="getFourthMonthSaleValue_2" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fourthSaleValue_2 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 判断上一个月销售额是否在  < 销售额 区间里  -->
	<select id="isSaleThree" parameterType="java.util.Map" resultType="java.lang.Integer">
		select count(1) from hcf_dealer_divide_account_template t where id=#{templateId} and #{saleMoney} &gt; saleThree
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第一个月份区间的参数值  -->
	<select id="getFristMonthSaleValue_3" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fristSaleValue_3 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第二个月份区间的参数值  -->
	<select id="getSecondMonthSaleValue_3" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select secondSaleValue_3 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第三个月份区间的参数值  -->
	<select id="getThreeMonthSaleValue_3" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select threeSaleValue_3 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询属于 <  销售额  ≤ 区间里 第四个月份区间的参数值  -->
	<select id="getFourthMonthSaleValue_3" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fourthSaleValue_3 from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 判断机器补贴是否属于第一个月区间 -->
	<select id="isFristMonth_vend" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			select count(1) from hcf_dealer_divide_account_template where id=#{templateId} and #{mNum} BETWEEN fristMonthOne_vend and fristMonthTwo_vend
		]]>
	</select>
	
	<!-- 判断机器补贴是否属于第二个月区间 -->
	<select id="isSecondMonth_vend" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			select count(1) from hcf_dealer_divide_account_template where id=#{templateId} and #{mNum} BETWEEN secondMonthOne_vend and secondMonthTwo_vend
		]]>
	</select>
	
	<!-- 判断机器补贴是否属于第三个月区间 -->
	<select id="isThreeMonth_vend" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			select count(1) from hcf_dealer_divide_account_template where id=#{templateId} and #{mNum} BETWEEN threeMonthOne_vend and threeMonthTwo_vend
		]]>
	</select>
	
	<!-- 判断机器补贴是否属于第四个月区间 -->
	<select id="isFourthMonth_vend" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			select count(1) from hcf_dealer_divide_account_template where id=#{templateId} and #{mNum} BETWEEN fourthMonthOne_vend and fourthMonthTwo_vend
		]]>
	</select>
	
	<!-- 查询机器补贴第一个月区间的值 -->
	<select id="getFristMonthVendValue" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fristSaleValue_vend from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询机器补贴第二个月区间的值 -->
	<select id="getSecondMonthVendValue" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select secondSaleValue_vend from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询机器补贴第三个月区间的值 -->
	<select id="getThreeMonthVendValue" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select threeSaleValue_vend from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询机器补贴第四个月区间的值 -->
	<select id="getFourthMonthVendValue" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select fourthSaleValue_vend from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询模版的广告费 -->
	<select id="getAdMoney" parameterType="java.lang.String" resultType="java.lang.Integer">
		<![CDATA[
			select advertMoney from hcf_dealer_divide_account_template where id=#{templateId}
		]]>
	</select>
	
	<!-- 查询上一个月所有机器的广告 -->
	<select id="beforeAdListMap" parameterType="java.lang.String" resultType="java.util.Map">
		<![CDATA[
			SELECT
				aDList
			FROM
				hkf_vend_rele_ad
			WHERE
				vendCode IN (${vendCodes})
			AND PERIOD_DIFF(
				DATE_FORMAT(NOW(), '%Y%m'),
				DATE_FORMAT(createTime, '%Y%m')
			) = 1
		]]>
	</select>
	
	<!-- 查询当前月所有机器的广告 -->
	<select id="currentAdListMap" parameterType="java.lang.String" resultType="java.util.Map">
		<![CDATA[
			SELECT
				aDList
			FROM
				hkf_vend_rele_ad
			WHERE
				vendCode IN (${vendCodes})
			AND DATE_FORMAT(createTime,'%Y%m') = DATE_FORMAT(CURDATE(),'%Y%m')
		]]>
	</select>
	
	<!-- 保存代理商的补贴    -->
	<insert id="saveDealerFoundFlowVo" useGeneratedKeys="true" keyProperty="id">
		<![CDATA[
			INSERT INTO hcf_dealer_fundFlow (
				loginName,
				settlementMonth,
				amount,
				amountType,
				amountStatus,
				checkoutTime,
				serialsNumber
			)
			VALUES
				(
					#{loginName},
					#{settlementMonth},
					#{amount},
					${amountType},
					${amountStatus},
					NOW(),
					#{serialsNumber}
				)
		]]>
	</insert>
	
	<!-- 更新代理商补贴记录 -->
	<update id="updateDealerFoundFlowVo" parameterType="com.huilian.hlej.hcf.vo.DealerFoundFlowVo">
		update hcf_dealer_fundFlow set amount=#{amount} 
		where 
			loginName=#{loginName} 
		and amountType=#{amountType}
		and amountStatus=#{amountStatus}
		AND DATE_FORMAT(settlementMonth, '%Y-%m-%d') = #{settlementMonth}
	</update>
	
	<!-- 查询该代理商的该类型的补贴记录是否已存在 -->
	<select id="isExistFoundByLoginName" parameterType="java.util.Map" resultType="java.lang.Integer">
		select count(*) from hcf_dealer_fundFlow 
		WHERE 
			loginName=#{loginName} 
		and amountType=#{amountType}
		AND amountStatus = #{amountStatus} 
		AND DATE_FORMAT(settlementMonth, '%Y-%m-%d') = #{settlementMonth}
	</select>
	
	<!-- 更新补贴状态 -->
	<update id="updateAmountStatus" parameterType="java.util.Map">
		update hcf_dealer_fundFlow set amountStatus=#{amountStatus} where loginName=#{loginName} and amountType=#{amountType}
	</update>
	
	<resultMap id="getCheckAmountMap" type="com.huilian.hlej.hcf.vo.CheckUpAccountVo">
		<result column="timeStr" property="timeDuan" jdbcType="VARCHAR"/>
		<result column="dealerName" property="dealerName" jdbcType="VARCHAR"/>
		<result column="loginName" property="loginName" jdbcType="VARCHAR"/>
		<result column="incomeMoney" property="incomeMoney" jdbcType="DOUBLE"/>
		<result column="expenditureMoney" property="expenditureMoney" jdbcType="DOUBLE"/>
	</resultMap>
	
	<!-- 查询对帐单列表  -->
	<select id="getCheckUpAccountList" parameterType="com.huilian.hlej.hcf.vo.CheckUpAccountVo" resultMap="getCheckAmountMap">
		select t1.loginName,t2.dealerName,
		CONCAT(
				DATE_FORMAT(
					min(t1.settlementMonth),
					'%Y.%m.%d'
				),
				'-',
				DATE_FORMAT(
					max(t1.settlementMonth),
					'%Y.%m.%d'
				)
			) as timeStr,
			(SELECT SUM(amount*0.01) AS amount FROM hcf_dealer_fundFlow WHERE amountType in(1,2,3) and loginName = t1.loginName) as incomeMoney,
			(SELECT SUM(amount*0.01) AS amount FROM hcf_dealer_fundFlow WHERE amountType in(4,5) and loginName = t1.loginName) as expenditureMoney
		from hcf_dealer_fundFlow t1
		LEFT JOIN hcf_dealer_baseInfo t2
		on(t1.loginName = t2.loginName)
		<where>
			<if test="dealerName != null and  dealerName != ''">
	           AND t2.dealerName like CONCAT('%','${dealerName}','%' )
	        </if>
			<if test="startTimeStr != null and  startTimeStr != ''">
	           AND DATE_FORMAT(t1.settlementMonth, '%Y-%m-%d') &gt;=  #{startTimeStr}
	           </if>
	   		<if test="endTimeStr != null and  endTimeStr != ''">
	           AND DATE_FORMAT(t1.settlementMonth, '%Y-%m-%d') &lt;=  #{endTimeStr}
	        </if>
		</where>
		 GROUP BY t1.loginName
		 ORDER BY inComeMoney DESC
	</select>
	
	<!-- 查询结算的时间段  -->
	<select id="queryTimeDuan" parameterType="java.util.Map" resultType="java.lang.String">
		SELECT
			CONCAT(
				DATE_FORMAT(
					min(settlementMonth),
					'%Y.%m.%d'
				),
				'-',
				DATE_FORMAT(
					max(settlementMonth),
					'%Y.%m.%d'
				)
			) as timeStr
		FROM
			hcf_dealer_fundFlow
		<where>
			loginName = #{loginName}
			<if test="startTimeStr != null and  startTimeStr != ''">
	           	AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &gt;=  #{startTimeStr}
	        </if>
	   		<if test="endTimeStr != null and  endTimeStr != ''">
	            AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &lt;=  #{endTimeStr}
	        </if>
		</where>
	</select>
	
	<!-- 查询收入 -->
	<select id="queryIncomeMoney" parameterType="java.util.Map" resultType="java.lang.String">
		SELECT
			ifnull(sum(amount * 0.01),0) AS sumAmount
		FROM
			hcf_dealer_fundFlow
		<where>
			loginName = #{loginName} AND amountType IN (1, 2, 3)
			<if test="startTimeStr != null and  startTimeStr != ''">
	           	AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &gt;=  #{startTimeStr}
	           </if>
	   		<if test="endTimeStr != null and  endTimeStr != ''">
	            AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &lt;=  #{endTimeStr}
	        </if>
		</where>
	</select>
	
	<!-- 查询支出 -->
	<select id="queryExpenditureMoney" parameterType="java.util.Map" resultType="java.lang.String">
		SELECT
			ifnull(sum(amount*0.01),0) AS sumAmount
		FROM
			hcf_dealer_fundFlow
		<where>
			loginName = #{loginName} AND amountType in(4)
			<if test="startTimeStr != null and  startTimeStr != ''">
	           	AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &gt;=  #{startTimeStr}
	           </if>
	   		<if test="endTimeStr != null and  endTimeStr != ''">
	            AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &lt;=  #{endTimeStr}
	        </if>
		</where>
	</select>
	
	<!-- 查询流水号的个数 -->
	<select id="countBySerialsNumber" parameterType="java.lang.String" resultType="java.lang.Integer">
		select COUNT(1) from hcf_dealer_fundFlow where serialsNumber like CONCAT('%',#{serialsNumber},'%' )
	</select>
	
	<select id="querySettlementWay" parameterType="java.lang.String" resultType="java.lang.Integer">
		select settlementWay from hcf_dealer_divide_account_template where id=#{templateId}
	</select>
	
	<resultMap id="getAmountMapA" type="com.huilian.hlej.hcf.vo.AlreadyAccountVo">
		<result column="checkUpTimes" property="checkUpTimes" jdbcType="VARCHAR"/>
		<result column="dealerName" property="dealerName" jdbcType="VARCHAR"/>
		<result column="loginName" property="loginName" jdbcType="VARCHAR"/>
		<result column="incomeMoney" property="incomeMoney" jdbcType="DOUBLE"/>
		<result column="amountType" property="amountType" jdbcType="NUMERIC"/>
	</resultMap>
	
	<!-- 根据登录名查询已结算-->
	<select id="amountListA" parameterType="com.huilian.hlej.hcf.vo.AlreadyAccountVo" resultMap="getAmountMapA">
        select DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') as checkUpTimes,
        t2.dealerName,sum(amount * 0.01) AS incomeMoney,amountType,t1.loginName
        from hcf_dealer_fundFlow t1 
		left join hcf_dealer_baseInfo t2
		on (t1.loginName = t2.loginName)
		<where>
			t1.amountStatus =2 and amountType in(1,2,3)
			<if test="amountStatus != null and  amountStatus != ''">
           	AND t1.amountStatus=#{amountStatus}
           </if>
		   <if test="loginName != null and  loginName != ''">
           	AND t1.loginName = #{loginName}
           </if>
		   <if test="dealerName != null and  dealerName != ''">
           	AND t2.dealerName like CONCAT('%',#{dealerName},'%' )
           </if>
			<if test="startTimeStr != null and  startTimeStr != ''">
           	AND DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') &gt;=  #{startTimeStr}
           </if>
   			<if test="endTimeStr != null and  endTimeStr != ''">
            AND DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') &lt;=  #{endTimeStr}
        	</if>
		</where>
		group by t1.amountType,DATE_FORMAT(t1.checkoutTime, '%Y-%m-%d')
	</select>
	
	<resultMap id="getAmountMapW" type="com.huilian.hlej.hcf.vo.WaitingAccountVo">
		<result column="checkUpTimes" property="checkUpTimes" jdbcType="VARCHAR"/>
		<result column="dealerName" property="dealerName" jdbcType="VARCHAR"/>
		<result column="loginName" property="loginName" jdbcType="VARCHAR"/>
		<result column="incomeMoney" property="incomeMoney" jdbcType="DOUBLE"/>
		<result column="amountType" property="amountType" jdbcType="NUMERIC"/>
	</resultMap>
	<!-- 根据登录名查询待结算的记录 -->
	<select id="amountListW" parameterType="com.huilian.hlej.hcf.vo.WaitingAccountVo" resultMap="getAmountMapW">
        select DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') as checkUpTimes,
        t2.dealerName,sum(amount * 0.01) AS incomeMoney,amountType,t1.loginName
        from hcf_dealer_fundFlow t1 
		left join hcf_dealer_baseInfo t2
		on (t1.loginName = t2.loginName)
		<where>
			and amountType in(1,2,3)
			<if test="amountStatus != null and  amountStatus != ''">
           	AND t1.amountStatus=#{amountStatus}
           </if>
		   <if test="loginName != null and  loginName != ''">
           	AND t1.loginName = #{loginName}
           </if>
		   <if test="dealerName != null and  dealerName != ''">
           	AND t2.dealerName like CONCAT('%',#{dealerName},'%' )
           </if>
			<if test="startTimeStr != null and  startTimeStr != ''">
           	AND DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') &gt;=  #{startTimeStr}
           </if>
   			<if test="endTimeStr != null and  endTimeStr != ''">
            AND DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') &lt;=  #{endTimeStr}
        	</if>
		</where>
		group by t1.amountType,DATE_FORMAT(t1.checkoutTime, '%Y-%m-%d')
	</select>
	
	<!-- 查询已结算的记 -->
	<select id="queryClosedAccountMoney" parameterType="java.util.Map" resultType="java.lang.Double">
		select sum(amount) as sumAmount
		from 
		(
			SELECT
			amount * 0.01 as amount
		FROM
			hcf_dealer_fundFlow
		<where>
			loginName = #{loginName} AND amountStatus = 2
			<if test="startTimeStr != null and  startTimeStr != ''">
	           	AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &gt;=  #{startTimeStr}
	           </if>
	   		<if test="endTimeStr != null and  endTimeStr != ''">
	            AND DATE_FORMAT(settlementMonth,'%Y-%m-%d') &lt;=  #{endTimeStr}
	        </if>
		</where>
		) as temp
	</select>
	
	<!-- 查询其登录名下的所有机器码   -->
	<select id="getAllVendCodeByLoginName" parameterType="java.lang.String" resultType="java.lang.String">
		select GROUP_CONCAT(vendCode) as vendCodes from hcf_vend_dealer where loginName=#{loginName}
	</select>
	
	<!-- 根据机器编码日期查询销售额  -->
	<select id="querySaleMoneyByDate" parameterType="java.util.Map" resultType="java.lang.Double">
		SELECT
			sum(amount*0.01) AS saleMoney
		FROM
			hcf_vend_order_info
		WHERE
			vendCode IN (${vendCodes})
		AND DATE_FORMAT(shipTime, '%Y-%m-%d') = #{checkUpTimes}
		AND orderStatus = 1
	</select>
	
	<!-- 根据登录查询代理商最新应用的模版ID -->
	<select id="queryParmaIdByLoginName" parameterType="java.lang.String" resultType="java.util.Map">
		select templateId,DATE_FORMAT(useTime,'%Y-%m-%d') as useTimeStr from hcf_dealer_template WHERE loginName=#{loginName} order by useTime desc LIMIT 0,1
	</select>
	
	<!-- 根据登录名和时间查询决的机器补贴  -->
	<select id="queryTotalSubsidy" parameterType="java.util.Map" resultType="java.lang.Double">
		SELECT SUM(amount*0.01) FROM hcf_dealer_fundFlow  WHERE loginName=#{loginName} AND amountType=2 AND DATE_FORMAT(checkoutTime,'%Y-%m-%d') = #{checkUpTimes}
	</select>
	
	<!-- 查询机器补贴的期数 -->
	<select id="queryPeriods" parameterType="java.util.Map" resultType="java.lang.Integer">
		  SELECT COUNT(1) FROM 
			(
			SELECT 
			  checkoutTime 
			FROM
			  hcf_dealer_fundFlow 
			WHERE loginName = #{loginName}
			  AND amountType = 2 
			  AND amountStatus = 2 
			GROUP BY DATE_FORMAT(checkoutTime, '%Y-%m-%d')
			) AS temp 
	</select>
	
	<!-- 查询机器补贴 -->
	<select id="queryAcaMoney" parameterType="java.util.Map" resultType="java.lang.Double">
		SELECT SUM(amount*0.01) FROM hcf_dealer_fundFlow  WHERE loginName=#{loginName} AND DATE_FORMAT(checkoutTime,'%Y-%m-%d') = #{checkUpTimes} AND amountType=2 AND amountStatus=${amountStatus}
	</select>
	
	<!-- 查询某个时间段的广告数 -->
	<select id="queryAdvertisNum" parameterType="java.lang.String" resultType="java.util.Map">
		<![CDATA[
			SELECT
				aDList
			FROM
				hkf_vend_rele_ad
			WHERE
				vendCode IN (${vendCodes})
			AND DATE_FORMAT(createTime,'%Y-%m') = #{yearMonthStr}
		]]>
	</select>
	
	<!-- 查询已推送的广告机器数 -->
	<select id="aleardyPushNum" parameterType="java.util.Map" resultType="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) FROM 
			(
			SELECT 
			  vendCode
			FROM
			  hkf_vend_rele_ad 
			WHERE vendCode IN (${vendCodes}) 
			  AND DATE_FORMAT(createTime,'%Y-%m') = #{yearMonthStr}
			  AND adStatus = 1 GROUP BY vendCode
			) AS temp
		]]>
	</select>
	
	<resultMap id="outAmountMap" type="com.huilian.hlej.hcf.vo.OutAccountVo">
		<result column="checkUpTimes" property="checkUpTimes" jdbcType="VARCHAR"/>
		<result column="dealerName" property="dealerName" jdbcType="VARCHAR"/>
		<result column="loginName" property="loginName" jdbcType="VARCHAR"/>
		<result column="expenditureMoney" property="expenditureMoney" jdbcType="DOUBLE"/>
		<result column="amountType" property="amountType" jdbcType="NUMERIC"/>
		<result column="amountStatus" property="amountStatus" jdbcType="NUMERIC"/>
	</resultMap>
	
	<!-- 根据登录名查询支出算的记录 -->
	<select id="outAmountList" parameterType="com.huilian.hlej.hcf.vo.OutAccountVo" resultMap="outAmountMap">
        select DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') as checkUpTimes,
        t2.dealerName,sum(amount * 0.01) AS expenditureMoney,amountType,t1.loginName,t1.amountStatus
        from hcf_dealer_fundFlow t1 
		left join hcf_dealer_baseInfo t2
		on (t1.loginName = t2.loginName)
		<where>
			amountType in(4,5)
		   <if test="loginName != null and  loginName != ''">
           	AND t1.loginName = #{loginName}
           </if>
		   <if test="dealerName != null and  dealerName != ''">
           	AND t2.dealerName like CONCAT('%',#{dealerName},'%' )
           </if>
			<if test="startTimeStr != null and  startTimeStr != ''">
           	AND DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') &gt;=  #{startTimeStr}
           </if>
   			<if test="endTimeStr != null and  endTimeStr != ''">
            AND DATE_FORMAT(t1.checkoutTime,'%Y-%m-%d') &lt;=  #{endTimeStr}
        	</if>
		</where>
		group by t1.amountType,DATE_FORMAT(t1.checkoutTime, '%Y-%m-%d')
	</select>
</mapper>   
