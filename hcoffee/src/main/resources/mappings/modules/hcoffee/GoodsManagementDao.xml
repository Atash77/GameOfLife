<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
         符号转义说明
    &lt;          < 	
    &gt;          >  
    &lt;&gt;     <>
    &amp;        & 
    &apos;       '
    &quot;       "
  <![CDATA[ 这里写你的SQL或者符号 ]]> 
 -->
<mapper namespace="com.huilian.hlej.hcf.dao.GoodsManagementDao" > 

	<insert id="saveGoodsVo" useGeneratedKeys="true" keyProperty="id">
		<![CDATA[
			INSERT INTO `hcf_goods_details` (
			  `goodsName` ,
			  `goodsId` ,
			  `priceInto` ,
			  `priceOut` ,
			  `pictureUrl`,
			  `specification` ,
			  `typeId` ,
			  `count` ,
			  `goodsBrand` ,
			  `packagesNumber` ,
			  `createTime` ,
			  `updateTime` 
			)
			VALUES
				(
					#{goodsName},
					#{goodsId},
					${priceInto},
					${priceOut},
					#{pictureUrl},
					#{specification},
					#{typeId},
					#{count},
					#{goodsBrand},
					#{packagesNumber},
					now(),
					now()
				)
			]]> 
	</insert>
	
	<resultMap id="goodsVoListMap" type="com.huilian.hlej.hcf.vo.GoodsVo">
		<result column="id" property="id" jdbcType="NUMERIC"/>
		<result column="goodsName" property="goodsName" jdbcType="VARCHAR"/>
		<result column="typeName" property="typeName" jdbcType="VARCHAR"/>
		<result column="goodsId" property="goodsId" jdbcType="VARCHAR"/>
		<result column="priceInto" property="priceInto" jdbcType="REAL"/>
		<result column="priceOut" property="priceOut" jdbcType="REAL"/>
		<result column="pictureUrl" property="pictureUrl" jdbcType="VARCHAR"/>
		<result column="specification" property="specification" jdbcType="VARCHAR"/>
		<result column="typeId" property="typeId" jdbcType="NUMERIC"/>
		<result column="count" property="count" jdbcType="NUMERIC"/>
		<result column="goodsBrand" property="goodsBrand" jdbcType="VARCHAR"/>
		<result column="packagesNumber" property="packagesNumber" jdbcType="VARCHAR"/>
		<result column="createTime" property="createTime" jdbcType="VARCHAR"/>
		<result column="updateTime" property="updateTime" jdbcType="VARCHAR"/>
		<result column="isSale" property="isSale" jdbcType="NUMERIC"/>
	</resultMap>

	<select id="getGoodsVoList" resultMap="goodsVoListMap"
		parameterType="com.huilian.hlej.hcf.vo.GoodsVo">
		SELECT
			id,
			goodsName,
			goodsId,
			TRUNCATE(priceInto*0.01,2) as priceInto,
			TRUNCATE(priceOut*0.01,2) as priceOut,
			pictureUrl,
			specification,
			typeId,
			count,
			goodsBrand,
			packagesNumber,
			createTime,
			updateTime,
			isSale
		FROM
			hcf_goods_details
		where 1=1
		<if test="typeId != null and  typeId != ''">
			AND hcf_goods_details.typeId = #{typeId}
		</if>
		<if test="goodsName != null and  goodsName != ''">
			AND hcf_goods_details.goodsName like CONCAT('%','${goodsName}','%' )
		</if>
		ORDER BY hcf_goods_details.updateTime DESC  
	</select>
	
	<update id="updateGoodsVo" parameterType="com.huilian.hlej.hcf.vo.GoodsVo">
		UPDATE `hcf_goods_details`
		<set>
			<if test="goodsId!=null and goodsId!=''">
				goodsId = #{goodsId},
			</if>
			<if test="goodsName!=null and goodsName!=''">
				goodsName = #{goodsName},
			</if>
			<if test="priceInto!=null and priceInto!=''">
				priceInto = ${priceInto},
			</if>
			<if test="priceOut!=null and priceOut!=''">
				priceOut = ${priceOut},
			</if>
			<if test="pictureUrl!=null and pictureUrl!=''">
				pictureUrl = #{pictureUrl},
			</if>
			<if test="specification!=null and specification!=''">
				specification = #{specification},
			</if>
			<if test="typeId!=null and typeId!=''">
				typeId = #{typeId},
			</if>
			<if test="goodsBrand!=null and goodsBrand!=''">
				goodsBrand = #{goodsBrand},
			</if>
			<if test="packagesNumber!=null and packagesNumber!=''">
				packagesNumber = #{packagesNumber},
			</if>
			updateTime = now()
			<where>
				id = #{id}
			</where>
		</set>
	</update>
	
	<select id="getGoodsVoById" resultMap="goodsVoListMap"
		parameterType="java.lang.String">
		SELECT
			t1.id,
			goodsId,
			goodsName,
			t2.typeName,
			TRUNCATE(priceInto*0.01,2)as priceInto,
			TRUNCATE(priceOut*0.01,2) as priceOut,
			pictureUrl,
			specification,
			t1.typeId,
			count,
			goodsBrand,
			packagesNumber,
			createTime,
			updateTime
		FROM
			hcf_goods_details t1,hcf_goods_type t2
		where t1.typeId = t2.id and t1.id = #{id}
	</select>
	
	<update id="updateIsSale" parameterType="com.huilian.hlej.hcf.vo.GoodsVo">
		<![CDATA[
			UPDATE hcf_goods_details set isSale = #{isSale} where id = #{id}
		]]> 
	</update>

</mapper>   
